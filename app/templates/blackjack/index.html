{% extends "win98_window.html" %}

{% block title %}Blackjack Trainer{% endblock %}
{% block window_title %}Blackjack Trainer{% endblock %}
{% block taskbar_title %}Blackjack{% endblock %}

{% set window_icon = 'cards.svg' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/blackjack.css') }}">
{% endblock %}

{% block menu_bar %}
<div class="win98-menu-bar">
    <div class="bj-menu-wrap">
        <span class="win98-menu-item" data-menu="game">Game</span>
        <div class="bj-dropdown" id="menu-game">
            <div class="bj-dropdown-item" data-action="deal">Deal New Hand<span style="float:right;color:var(--win98-text-disabled)">F2</span></div>
            <div class="bj-dropdown-sep"></div>
            <div class="bj-dropdown-item" data-action="stats">Statistics...</div>
            <div class="bj-dropdown-item" data-action="strategy">Strategy Chart...</div>
            <div class="bj-dropdown-sep"></div>
            <div class="bj-dropdown-item" data-action="reset">Reset Stats</div>
        </div>
    </div>
    <div class="bj-menu-wrap">
        <span class="win98-menu-item" data-menu="options">Options</span>
        <div class="bj-dropdown" id="menu-options">
            <div class="bj-dropdown-item bj-dropdown-check" id="menu-hints" data-action="toggle-hints"><span class="bj-check-mark"></span>Show Hints</div>
        </div>
    </div>
    <div class="bj-menu-wrap">
        <span class="win98-menu-item" data-menu="help">Help</span>
        <div class="bj-dropdown" id="menu-help">
            <div class="bj-dropdown-item" data-action="about">About Blackjack Trainer</div>
        </div>
    </div>
</div>
{% endblock %}

{% block window_content %}
<!-- Green Felt -->
<div class="bj-felt">
    <!-- Dealer -->
    <div class="bj-hand-area">
        <div class="bj-hand-label">Dealer</div>
        <div class="bj-cards" id="dealer-cards"></div>
        <div class="bj-hand-total" id="dealer-total"></div>
    </div>

    <!-- Result Dialog (centered on felt) -->
    <div class="bj-result" id="result-dialog" style="display:none">
        <div class="bj-result-title">Blackjack Trainer</div>
        <div class="bj-result-body">
            <span id="result-text"></span>
        </div>
        <div class="bj-result-buttons">
            <button class="win98-btn" id="result-ok">OK</button>
        </div>
    </div>

    <!-- Player -->
    <div class="bj-hand-area">
        <div class="bj-hand-label">Player</div>
        <div id="player-hands">
            <div class="bj-player-hand" data-hand="0">
                <div class="bj-cards" id="player-cards-0"></div>
                <div class="bj-hand-total" id="player-total-0"></div>
            </div>
        </div>
    </div>

    <!-- Betting Area (shown when not playing) -->
    <div class="bj-betting-area" id="betting-area">
        <div class="bj-felt-chips">
            <button class="bj-felt-chip" data-value="5" style="--chip-color:#c00" title="$5">5</button>
            <button class="bj-felt-chip" data-value="25" style="--chip-color:#0a0" title="$25">25</button>
            <button class="bj-felt-chip" data-value="100" style="--chip-color:#222" title="$100">100</button>
            <button class="bj-felt-chip" data-value="500" style="--chip-color:#808" title="$500">500</button>
        </div>
        <div class="bj-bet-display" id="bet-display">$0</div>
        <div class="bj-bet-buttons">
            <button class="win98-btn" id="clear-bet">Clear</button>
            <button class="win98-btn" id="deal-btn" disabled>Deal</button>
        </div>
    </div>

    <!-- Action Bar (shown during play) -->
    <div class="bj-action-bar hidden" id="action-bar">
        <button class="win98-btn" id="hit-btn" disabled>Hit</button>
        <button class="win98-btn" id="stand-btn" disabled>Stand</button>
        <button class="win98-btn" id="double-btn" disabled>Double</button>
        <button class="win98-btn" id="split-btn" disabled>Split</button>
        <button class="win98-btn" id="insurance-btn" disabled>Insurance</button>
    </div>
</div>

<!-- Stats Dialog -->
<div class="bj-dialog-overlay" id="stats-dialog" style="display:none">
    <div class="bj-dialog" style="width:320px">
        <div class="bj-dialog-titlebar">
            <span>Statistics</span>
            <button class="bj-dialog-close" data-close="stats-dialog">&#215;</button>
        </div>
        <div class="bj-dialog-content">
            <div class="bj-groupbox">
                <span class="bj-groupbox-label">Session</span>
                <dl class="bj-stats-grid">
                    <dt>Hands Played:</dt><dd id="stat-hands">0</dd>
                    <dt>Optimal Play:</dt><dd id="stat-accuracy">--</dd>
                    <dt>Session P/L:</dt><dd id="stat-pl">$0</dd>
                </dl>
            </div>
            <div class="bj-groupbox">
                <span class="bj-groupbox-label">Accuracy by Type</span>
                <dl class="bj-stats-grid">
                    <dt>Hard:</dt><dd id="stat-hard">--</dd>
                    <dt>Soft:</dt><dd id="stat-soft">--</dd>
                    <dt>Pairs:</dt><dd id="stat-pair">--</dd>
                    <dt>Doubles:</dt><dd id="stat-double">--</dd>
                </dl>
            </div>
            <div class="bj-groupbox">
                <span class="bj-groupbox-label">Recent Mistakes</span>
                <div class="bj-mistakes-list" id="mistakes-list">
                    <div class="bj-no-mistakes">No mistakes yet!</div>
                </div>
            </div>
        </div>
        <div class="bj-dialog-buttons">
            <button class="win98-btn" data-close="stats-dialog">Close</button>
        </div>
    </div>
</div>

<!-- Strategy Chart Dialog -->
<div class="bj-dialog-overlay" id="strategy-dialog" style="display:none">
    <div class="bj-dialog" style="max-width:90vw;max-height:90vh">
        <div class="bj-dialog-titlebar">
            <span>Basic Strategy Chart</span>
            <button class="bj-dialog-close" data-close="strategy-dialog">&#215;</button>
        </div>
        <div class="bj-dialog-content bj-strategy-chart" style="overflow:auto">
            <div style="font-size:10px;margin-bottom:8px">6-Deck, Dealer Stands on Soft 17</div>
            <div id="strategy-chart"></div>
        </div>
        <div class="bj-dialog-buttons">
            <button class="win98-btn" data-close="strategy-dialog">Close</button>
        </div>
    </div>
</div>

<!-- About Dialog -->
<div class="bj-dialog-overlay" id="about-dialog" style="display:none">
    <div class="bj-dialog" style="width:300px">
        <div class="bj-dialog-titlebar">
            <span>About Blackjack Trainer</span>
            <button class="bj-dialog-close" data-close="about-dialog">&#215;</button>
        </div>
        <div class="bj-dialog-content" style="text-align:center;padding:16px">
            <div style="font-weight:bold;font-size:12px;margin-bottom:8px">Blackjack Trainer</div>
            <div style="font-size:11px;margin-bottom:8px">Practice basic strategy with real-time feedback.</div>
            <div style="font-size:10px;color:var(--win98-text-disabled)">6-deck shoe &#8226; Dealer stands on soft 17</div>
        </div>
        <div class="bj-dialog-buttons">
            <button class="win98-btn" data-close="about-dialog">OK</button>
        </div>
    </div>
</div>
{% endblock %}

{% block status_bar %}
<div class="win98-status-bar bj-status-bar">
    <span class="win98-status-section" id="status-balance">Balance: $1000</span>
    <span class="win98-status-section" id="status-bet">Bet: $0</span>
    <span class="win98-status-section bj-status-feedback" id="status-feedback"></span>
    <span class="win98-status-section" id="status-accuracy">-- Optimal</span>
    <span class="win98-status-section" id="status-hands">0 hands</span>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/blackjack-engine.js') }}"></script>
<script>
{% include 'blackjack/game.js' %}
</script>
{% endblock %}
